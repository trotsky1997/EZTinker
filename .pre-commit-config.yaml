# 简化的 Pre-commit hooks
# 只保留核心检查：Ruff + Pyright
repos:
  # Ruff: 三阶段处理（导入排序 -> 完整 lint -> 格式化）
  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.8.2
    hooks:
      # 1. 仅格式化，包含导入排序
      - id: ruff-format
        name: "Ruff: 格式化"
        args: [check, --fix, --select, I, --exit-non-zero-on-fix]
        stages: [pre-commit]
        types: [python]

      # 2. 完整 lint 检查并自动修复
      - id: ruff
        name: "Ruff: Lint + 自动修复"
        args: [--fix, --exit-non-zero-on-fix]
        stages: [pre-commit]
        types: [python]

      # 3. 代码格式化
      - id: ruff-format
        name: "Ruff: 代码格式化"
        stages: [pre-commit]
        types: [python]

  # Semgrep: 安全扫描（检测安全漏洞和有害模式）
  - repo: https://github.com/semgrep/pre-commit
    rev: v1.146.0
    hooks:
      - id: semgrep
        name: "Semgrep: 安全扫描"
        args: ["--config", "auto", "--error"]
        verbose: true
        stages: [pre-commit]

# 配置
fail_fast: true  # 一个失败就停止
minimum_pre_commit_version: "2.9.0"

default_language_version:
  python: python3.11

default_stages: [pre-commit]